---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';
import VideoEmbed from '../../components/VideoEmbed.astro';

export async function getStaticPaths() {
  const films = await getCollection('films');
  return films.map((film) => ({
    params: { id: film.id.replace(/\.md$/, '') },
    props: { film },
  }));
}

const { film } = Astro.props;
const { Content } = await render(film);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-GB', {
    day: 'numeric',
    month: 'short',
    year: 'numeric',
  });
}
---

<Base title={film.data.title} ogImage={`/og/films/${film.id.replace(/\.md$/, '')}.png`}>
  <article class="film-viewer">
    <header>
      {film.data.showTitle ? <h1>{film.data.title}</h1> : null}
      <p class="film-date">{formatDate(film.data.date)}</p>
    </header>

    <VideoEmbed
      url={film.data.videoUrl}
      type={film.data.videoType}
      title={film.data.title}
    />

    <div class="film-content">
      <Content />
    </div>
  </article>
</Base>
