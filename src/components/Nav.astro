---
import { getEntry, getCollection } from 'astro:content';

const siteConfig = await getEntry('site', 'config');
const siteTitle = siteConfig?.data.title ?? 'elwyn';
const navLinks = siteConfig?.data.navLinks ?? [];

const pages = await getCollection('pages', ({ data }) => data.showInNav);
const sortedPages = pages.sort((a, b) => a.data.navOrder - b.data.navOrder);
const films = await getCollection('films', ({ data }) => !data.draft);
const hasFilms = films.length > 0;
---

<nav class="nav">
  <a href="/" class="nav-brand">
    <img src="/images/logo.webp" alt={siteTitle} class="nav-logo" />
    <span class="nav-title">{siteTitle}</span>
  </a>
  <div class="nav-links">
    {hasFilms ? <a href="/">films</a> : null}
    {sortedPages.map((page) => (
      <a href={`/${page.id.replace(/\.md$/, '')}`}>{page.data.title}</a>
    ))}
    {navLinks.map((link) => (
      <a
        href={link.url}
        target={link.newTab ? '_blank' : undefined}
        rel={link.newTab ? 'noopener noreferrer' : undefined}
      >
        {link.label}
      </a>
    ))}
  </div>
</nav>
